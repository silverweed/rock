<!DOCTYPE html>
<html>
    <head>
        <title>Rock Interpreter</title>
        <script src='rock.js'></script>
		<link rel="stylesheet" href="lib/LDT/TextareaDecorator.css">
        <link rel='stylesheet' href='style.css'/>
		<style>
			/* highlight styles */
			.ldt .comment { color: silver; }
			.ldt .string { color: green; }
			.ldt .number { color: blue; }
			/* setting inline-block and margin to avoid misalignment bug in windows */
			.ldt .keyword { font-weight: bold; display: inline-block; margin-bottom: -1px; }
			.ldt .variable { color: green; }
			.ldt .define { color: magenta; }
            .ldt .op { color: gold; }
            .ldt .label { color: red; }
            .ldt .value { color: blue; }
            .ldt .array { color: blue; }
            .ldt .builtin { color: cyan; }
		</style>
        <script src="lib/LDT/Parser.js"></script> 
        <script src="lib/LDT/TextareaDecorator.js"></script>
		<script>
			// generic syntax parser
			var parser = new Parser({
				whitespace: /\s+/,
				comment: /--.*/,
				string: /"(\\.|[^"\r\n])*"?|'(\\.|[^'\r\n])*'?/,
				number: /0x[\dA-Fa-f]+|-?(\d+\.?\d*|\.\d+)/,
				keyword: /(call|del|die|jump|jumpif|put|return|say)(?!\w|=)/,
				variable: /\$res/,
				define: /^#.*/,
                op: /(\+|-|\*|\/|%|\^|:=|==|=|<>|<=|>=|<|>|is|isnt|xor|&&|\|\||\.\.) /,
                label: /[a-zA-Z_][a-zA-Z0-9_]*:/,
                builtin: /floor|append|flatten|len|not|slice|\?/,
                value: /True|False|Nil/,
                array: /\[[0-9]?/,
				other: /\S+/,
			});
			// wait for the page to finish loading before accessing the DOM
			window.onload = function(){
				// get the textarea
				var textarea = document.getElementById('code');
				// start the decorator
				decorator = new TextareaDecorator(textarea, parser);
			};
		</script>
    </head>
    <body>
        <div id='headerwrapper'>
            <div id='buttons'>
                <button id='exe' onclick='exe()'>Execute</button>
                <button id='clear' onclick='clearOut()'>Clear</button>
                <input onchange='verbAdj()' type='range' min="0" max="3" value="0" id='verb'/>
                <label for='verb' id='verblb'>Verbosity: 0</label>
            </div>
            <div id='titlewrapper'>
                <h1>Try Rock!</h1>
                <h4>v2.0 - <a href='https://github.com/silverweed/rock'>Hosted on GitHub</a></h4>
                <div id='syntaxwrapper'>
                    <label for='syntax'>Syntax</label>
                    <input type='checkbox' id='syntax' value='Syntax' onclick='toggleSyntax()' checked />
                </div>
            </div>
        </div>
        <div id='wrapper'>
            <div id='codewrapper'>
                <textarea id='code' class='input' spellcheck='false'>
-- Example Rock program
-- Print all primes up to limit.

limit := 1000
i := 2
p := " is prime

-- main loop
loop:
    call is_prime i
    jumpif noprint $res is False
    say i .. p
noprint:
    jumpif end i == limit
    i = i + 1
    jump loop
end:
    die

-- returns true if n is prime, false otherwise.
is_prime: n
    -- square root of n
    jumpif is_prime_true n is 2
    lim := n ^ 0.5
    lim = floor lim
    lim = lim + 1
    i := 2
is_prime_loop:
    tmp := n % i
    jumpif is_prime_false tmp is 0
    jumpif is_prime_true i == lim
    i = i + 1
    jump is_prime_loop
is_prime_false:
    return False
is_prime_true:
    return True
                </textarea>
            </div>
            <div id='output'></div>
        </div>
        <script>
        var $code = document.getElementById('code');
        var $out = document.getElementById('output');
        var verb = document.getElementById('verb');
        var verblb = document.getElementById('verblb');
        var syntaxb = document.getElementById('syntax');
        function exe() {
            clearOut();
            executeRock($code.value);
        }
        function clearAll() {
            clearCode();
            clearOut();
        }
        function clearOut() {
            $out.innerHTML = "";
        }
        function clearCode() {
            $code.value = "";
        }
        function verbAdj() {
            $debuglv = verb.value;
            verblb.innerHTML = "Verbosity: " + $debuglv;
        }
        function toggleSyntax() {
            var pre = document.getElementsByTagName('pre')[0];
            if (syntaxb.checked) {
                pre.style.visibility = '';
                code.style.color = '';
            } else {
                pre.style.visibility = 'hidden';
                code.style.color = 'rgba(0, 0, 0, 1)';
            }
        }
        </script>
    </body>
</html>
